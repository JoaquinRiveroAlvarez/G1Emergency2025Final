@page "/pacientes/{eventoId:int}"
@inject IHttpServicio Http

<h3 class="text-light">Paciente del evento @evento?.Codigo</h3>


@if (cargando)
{
    <div class="alert alert-info">Cargando pacientes...</div>
}
else if (evento == null || evento.Pacientes.Count == 0)
{
    <div class="alert alert-warning">No se encontraron pacientes para este evento.</div>
}
else
{
   

    @foreach (var p in evento.Pacientes)
    {
        
        
            <div class="card bg-white text-dark mb-3" style="max-width: 500px; font-size: 1rem;">
                <div class="card-body py-3 px-4">
                    <p class="mb-2"><strong>Nombre:</strong> @p.NombrePersona</p>
                    <p class="mb-2"><strong>DNI:</strong> @p.DNIPersona</p>
                    <p class="mb-2"><strong>Edad:</strong> @p.EdadPersona</p>
                    <p class="mb-2"><strong>Obra Social:</strong> @p.ObraSocial</p>
                    <p class="mb-2"><strong>Diagnóstico:</strong> @p.DiagnosticoPresuntivo</p>
                </div>
            </div>
        

    }


    <NavLink class="btn btn-secondary mt-3" href="/eventos">
        <i class="bi bi-arrow-left"></i> Volver a eventos
    </NavLink>

}

@code {
    [Parameter] public int eventoId { get; set; }

    private EventoDiagPresuntivoListadoDTO? evento;
    private bool cargando = true;

    protected override async Task OnInitializedAsync()
    {
        var resp = await Http.Get<List<EventoDiagPresuntivoListadoDTO>>("api/evento/ListaEventoCompleto");

        if (!resp.Error && resp.Respuesta != null)
        {
            evento = resp.Respuesta.FirstOrDefault(e => e.Id == eventoId);
            Console.WriteLine($"Evento {eventoId} tiene {evento?.Pacientes.Count} pacientes");
        }
        else
        {
            Console.WriteLine("Error al cargar eventos: " + resp.ObtenerError());
        }

        cargando = false;
    }
}
